{
  "processGroups": [
    {
      "identifier": "iot-sensors-group",
      "name": "IoT Sensors Integration",
      "comments": "Flujo para integrar sensores IoT reales (MQTT/HTTP) en lugar de simulaciones",
      "processors": [
        {
          "identifier": "consume-mqtt",
          "name": "ConsumeMQTT",
          "type": "org.apache.nifi.processors.mqtt.ConsumeMQTT",
          "position": {"x": 100, "y": 200},
          "config": {
            "properties": {
              "Broker URI": "tcp://localhost:1883",
              "Client ID": "nifi-transport-consumer",
              "Topic Filter": "vehicles/+/gps",
              "Quality of Service (QoS)": "1",
              "Max Queue Size": "100",
              "Max Flow Duration": "0 sec"
            },
            "schedulingStrategy": "TIMER_DRIVEN",
            "schedulingPeriod": "1 sec",
            "penaltyDuration": "30 sec",
            "yieldDuration": "1 sec",
            "bulletinLevel": "WARN",
            "runDurationMillis": 0,
            "concurrentlySchedulableTaskCount": 1,
            "autoTerminatedRelationships": []
          },
          "relationships": [
            {"name": "success", "autoTerminate": false},
            {"name": "failure", "autoTerminate": false}
          ],
          "state": "STOPPED"
        },
        {
          "identifier": "jolt-transform",
          "name": "JoltTransformJSON",
          "type": "org.apache.nifi.processors.standard.JoltTransformJSON",
          "position": {"x": 400, "y": 200},
          "config": {
            "properties": {
              "Jolt Specification": "[{\"operation\":\"shift\",\"spec\":{\"IMEI\":\"vehicle_id\",\"lat\":\"latitude\",\"lng\":\"longitude\",\"speed\":\"speed\",\"timestamp\":\"timestamp\"}},{\"operation\":\"modify-overwrite-beta\",\"spec\":{\"vehicle_id\":\"=concat('V',substring(@(1,IMEI),-3))\",\"timestamp\":\"=formatDate(@(1,timestamp),'yyyy-MM-dd HH:mm:ss')\",\"route_id\":\"R001\",\"status\":\"IN_TRANSIT\"}}]",
              "Jolt Transform": "jolt-transform-chain",
              "Jolt Transformation DSL": "Chain"
            },
            "schedulingStrategy": "TIMER_DRIVEN",
            "schedulingPeriod": "0 sec",
            "penaltyDuration": "30 sec",
            "yieldDuration": "1 sec",
            "bulletinLevel": "WARN",
            "runDurationMillis": 0,
            "concurrentlySchedulableTaskCount": 1,
            "autoTerminatedRelationships": []
          },
          "relationships": [
            {"name": "success", "autoTerminate": false},
            {"name": "failure", "autoTerminate": false}
          ],
          "state": "STOPPED"
        },
        {
          "identifier": "publish-kafka-iot",
          "name": "PublishKafka_2_6",
          "type": "org.apache.nifi.processors.kafka.pubsub.PublishKafka_2_6",
          "position": {"x": 700, "y": 200},
          "config": {
            "properties": {
              "Kafka Brokers": "localhost:9092",
              "Topic Name": "raw-data",
              "Delivery Guarantee": "1",
              "Max Request Size": "1 MB",
              "Acknowledge Timeout": "5 secs"
            },
            "schedulingStrategy": "TIMER_DRIVEN",
            "schedulingPeriod": "0 sec",
            "penaltyDuration": "30 sec",
            "yieldDuration": "1 sec",
            "bulletinLevel": "WARN",
            "runDurationMillis": 0,
            "concurrentlySchedulableTaskCount": 1,
            "autoTerminatedRelationships": []
          },
          "relationships": [
            {"name": "success", "autoTerminate": false},
            {"name": "failure", "autoTerminate": false}
          ],
          "state": "STOPPED"
        }
      ],
      "connections": [
        {
          "source": {
            "id": "consume-mqtt",
            "type": "PROCESSOR"
          },
          "destination": {
            "id": "jolt-transform",
            "type": "PROCESSOR"
          },
          "selectedRelationships": ["success"]
        },
        {
          "source": {
            "id": "jolt-transform",
            "type": "PROCESSOR"
          },
          "destination": {
            "id": "publish-kafka-iot",
            "type": "PROCESSOR"
          },
          "selectedRelationships": ["success"]
        }
      ],
      "controllerServices": [],
      "funnels": [],
      "inputPorts": [],
      "outputPorts": [],
      "labels": [],
      "remoteProcessGroups": []
    }
  ],
  "connections": [],
  "controllerServices": [],
  "funnels": [],
  "inputPorts": [],
  "outputPorts": [],
  "labels": [],
  "remoteProcessGroups": []
}
